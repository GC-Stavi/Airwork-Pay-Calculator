<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Airwork Pay Calculator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- General Layout & Base Styles --- */
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            background: linear-gradient(to bottom right, #f0f4f8, #e0e7ee);
            color: #334155;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* --- Top Banner --- */
        .top-banner {
            width: 100%;
            background-color: #1e293b; /* Dark blue-gray */
            padding: 0.8em 20px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.25);
            z-index: 100;
            color: #ffffff;
        }

        .top-banner h1 {
            font-size: 1.8em;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            margin: 0;
            font-weight: 700;
        }

        /* --- Page Header --- */
        header {
            width: 100%;
            max-width: 1000px;
            text-align: center;
            margin: 2rem auto 0;
            padding: 0 20px;
        }

        header p {
            font-size: 1.1em;
            color: #64748b;
            margin-bottom: 20px;
        }

        header hr {
            max-width: 250px;
            margin: 20px auto 30px auto;
            border: 0;
            border-top: 2px solid #cbd5e1;
        }

        /* --- Main Content Container --- */
        .container {
            max-width: 1000px;
            width: 95%;
            margin: 1rem auto;
            background: #ffffff;
            padding: 2em;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
        }
        
        /* --- Form & Input Styles --- */
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #475569;
        }

        .input-group select, .input-group input {
            width: 100%;
            padding: 0.8em;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-size: 1em;
            background-color: #f8fafc;
        }

        textarea#rosterInput {
            width: 100%;
            height: 200px;
            font-family: monospace;
            padding: 1em;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            resize: vertical;
            font-size: 14px;
            margin-bottom: 1.5rem;
        }
        
        .calculate-section {
            display: flex;
            justify-content: center;
            margin-top: 1rem;
        }

        /* --- Buttons & Controls --- */
        .top-controls {
            position: absolute;
            top: 15px;
            right: 20px;
            z-index: 110;
        }
        
        button {
            padding: 0.8em 1.6em;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            border-radius: 8px;
            border: 1px solid transparent;
            transition: all 0.2s ease;
        }
        
        button.primary-button {
            background: linear-gradient(to right, #4f46e5, #7c3aed);
            color: #ffffff;
            font-size: 1.1em;
            padding: 0.9em 2em;
        }
        
        button.primary-button:hover {
            opacity: 0.9;
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        .dark-toggle-btn {
            background: #e2e8f0;
            color: #475569;
        }

        /* --- Modal Styles --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: none; /* Initially hidden */
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: #ffffff;
            padding: 2em;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.25);
            max-width: 700px;
            width: 90%;
            position: relative;
        }

        .modal-close-button {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 1.8em;
            font-weight: bold;
            color: #94a3b8;
            cursor: pointer;
            background: none;
            border: none;
            padding: 0;
            line-height: 1;
        }

        .modal-content h3, .modal-content h4 {
            margin-top: 0;
            margin-bottom: 1rem;
            color: #1e293b;
        }

        .modal-content hr {
            border: 0;
            border-top: 1px solid #e2e8f0;
            margin: 1.5rem 0;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .results-grid p {
            margin: 0.5rem 0;
        }
        
        .total-pay-section {
            text-align: center;
            margin-top: 1.5rem;
        }
        
        .total-pay-section p {
            font-size: 1.6em;
            font-weight: bold;
            color: #16a34a;
        }
        
        /* --- DARK MODE STYLES --- */
        body.dark-mode {
            background: linear-gradient(to bottom right, #1e293b, #0f172a);
            color: #e2e8f0;
        }

        body.dark-mode .container, body.dark-mode .modal-content {
            background: #1e293b;
            border: 1px solid #334155;
        }
        
        body.dark-mode .top-banner {
             background-color: #0f172a;
        }

        body.dark-mode header p {
            color: #94a3b8;
        }

        body.dark-mode header hr, body.dark-mode .modal-content hr {
            border-top-color: #475569;
        }

        body.dark-mode .dark-toggle-btn {
            background: #334155;
            color: #e2e8f0;
        }
        
        body.dark-mode .input-group label {
            color: #cbd5e1;
        }

        body.dark-mode .input-group select,
        body.dark-mode .input-group input,
        body.dark-mode textarea#rosterInput {
            background-color: #2d3748;
            border-color: #4a5568;
            color: #e2e8f0;
        }
        
        body.dark-mode .modal-content h3, body.dark-mode .modal-content h4 {
             color: #f1f5f9;
        }
        
        body.dark-mode .modal-close-button {
             color: #94a3b8;
        }

    </style>
</head>
<body>

    <div class="top-banner">
        <h1>Airwork Pay Calculator</h1>
    </div>

    <div class="top-controls">
        <button class="dark-toggle-btn" onclick="toggleDarkMode()" id="darkModeBtn">Dark Mode</button>
    </div>

    <header>
        <p>A tool to estimate pilot pay based on the Airwork 2017 Enterprise Agreement.</p>
        <hr>
    </header>

    <main class="container">
        
        <div class="input-grid">
            <div class="input-group">
                <label for="rankSelect">Rank</label>
                <select id="rankSelect">
                    <option value="First Officer">First Officer</option>
                    <option value="Captain">Captain</option>
                </select>
            </div>
            <div class="input-group">
                <label for="levelSelect">Pay Level</label>
                <select id="levelSelect">
                    <option value="1">Level 1 (1-3 Yrs)</option>
                    <option value="2">Level 2 (4 Yrs)</option>
                    <option value="3">Level 3 (5 Yrs)</option>
                    <option value="4">Level 4 (6 Yrs)</option>
                    <option value="5">Level 5 (7 Yrs)</option>
                    <option value="6">Level 6 (8+ Yrs)</option>
                </select>
            </div>
        </div>

        <div class="input-group">
            <label for="rosterInput">Paste Roster Text</label>
            <textarea id="rosterInput" placeholder="Paste the full text from your roster PDF here..."></textarea>
        </div>
        
        <div class="calculate-section">
            <button class="primary-button" onclick="runCalculation()">Calculate Pay</button>
        </div>
        
    </main>

    <!-- Results Modal -->
    <div id="resultsModal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-button" onclick="hideResultsModal()">&times;</button>
            <div id="modal-results-content">
                <!-- Results will be dynamically inserted here -->
            </div>
        </div>
    </div>
    
    <script>
        // --- GLOBAL VARIABLES ---
        let calculationResults = {};

        // --- DATA CONSTANTS (EBA Rates) ---
        const EBA_DATA = {
            "First Officer": {
                1: 134645.51, 2: 140812.55, 3: 147931.28, 
                4: 153524.47, 5: 160049.07, 6: 167370.08
            },
            "Captain": {
                1: 213689.97, 2: 219975.39, 3: 227532.08, 
                4: 236339.95, 5: 246400.17, 6: 255208.04
            },
            "ProductivityBonus": {
                "First Officer": 227.83,
                "Captain": 355.79
            },
            "OvertimeRate": {
                "First Officer": 78.00,
                "Captain": 120.00
            }
        };

        // --- UI FUNCTIONS (MODAL & DARK MODE) ---
        function showResultsModal() {
            document.getElementById('resultsModal').style.display = 'flex';
        }

        function hideResultsModal() {
            document.getElementById('resultsModal').style.display = 'none';
        }

        function toggleDarkMode() {
            const body = document.body;
            const btn = document.getElementById('darkModeBtn');
            const isDark = body.classList.toggle('dark-mode');
            btn.textContent = isDark ? 'Light Mode' : 'Dark Mode';
            localStorage.setItem('darkMode', isDark ? 'dark' : 'light');
        }

        // --- ON PAGE LOAD ---
        window.onload = function() {
            const savedMode = localStorage.getItem('darkMode');
            const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            if (savedMode === 'dark' || (!savedMode && prefersDark)) {
                document.body.classList.add('dark-mode');
                document.getElementById('darkModeBtn').textContent = 'Light Mode';
            }
            
            document.getElementById('rosterInput').value = `Kendell, Guy 0463AU BNE FO/73F
Name EmpNo Shortcode EMail BRQ
guy.kendell@airworkgroup.com
Date Des. Code LE CI Dep STD Arr STA CO BLH
STC
AC WA Func Rank
01 Sun RDO 0000 BNE 0000 BNE 2359 FO
02 Mon ADMIN 0900 BNE 0900 BNE 1700 1700 FO
03 Tue PAX 1750 BNE 1850 MEL 2120 2150 FO
HTL 0000 MEL 2150 MEL 1845+ FO
04 Wed QF7391 F 1845 MEL 1945 SYD 2105 FO 01:18
Crew: CP(Y,X): Gencic, Darko, FO: Kendell, Guy
73P
Y,X QF7392 F 0000 SYD 2200 MEL 2325 FO 01:29
Crew: CP: Gencic, Darko, FO(Y,X): Kendell, Guy
73P
05 Thu Y,X QF7394 F 0000 MEL 0030 PER 0235 0305 FO 04:12
Crew: CP: Gencic, Darko, FO(Y,X): Kendell, Guy
73P
HTL 0000 PER 0345 PER 1610 FO
QF7399 F 1620 PER 1720 MEL 2250 2236 FO 03:35
Crew: CP(Y,X): Gencic, Darko, FO: Kendell, Guy
73P
HTL 0000 MEL 2310 MEL 1020+ FO
06 Fri PIOT 0000 MEL 1020 BNE 1235 FO
07 Sat RDO 0000 BNE 0000 BNE 2359 FO
19 Thu QF7287 F 0000 LST 0210 MEL 0310 FO 00:56
Crew: CP(Y,X): Scott, William, FO: Kendell, Guy
73P
PAX 0000 MEL 0600 BNE 0815 0845 FO`;
            
            // Close modal if user clicks outside of the content
            document.getElementById('resultsModal').addEventListener('click', function(event) {
                if (event.target === this) {
                    hideResultsModal();
                }
            });
        };

        // --- CALCULATION & PARSING LOGIC ---
        function parseTimeToHours(timeStr) {
            if (!timeStr) return 0;
            timeStr = timeStr.replace(':', '');
            if (timeStr.length < 4) return 0;
            const hours = parseInt(timeStr.substring(0, 2), 10);
            const minutes = parseInt(timeStr.substring(2, 4), 10);
            return hours + (minutes / 60);
        }

        function parseRoster(rosterText) {
            const lines = rosterText.trim().split('\n');
            const parsedData = { rank: null, homeBase: null, duties: [] };
            const pilotInfoLine = lines.find(line => line.includes('BNE FO/73F') || line.includes('MEL CP/73F'));
            if (pilotInfoLine) {
                const baseMatch = pilotInfoLine.match(/(BNE|MEL|SYD|PER)/);
                if (baseMatch) parsedData.homeBase = baseMatch[0];
            }
            const timeRegex = /^\d{2}:\d{2}$/;
            const dutyLines = lines.filter(line => /^\d{2}\s+(Sun|Mon|Tue|Wed|Thu|Fri|Sat)/.test(line.trim()));
            dutyLines.forEach(line => {
                const parts = line.trim().split(/\s+/);
                if (parts.length < 3) return;
                const dutyCode = parts[2];
                let dutyHours = 0;
                if (dutyCode === 'ADMIN') {
                    const startTime = parseTimeToHours(parts[3]);
                    const endTime = parseTimeToHours(parts[7]);
                    if (endTime > startTime) dutyHours = endTime - startTime;
                } else if (dutyCode.startsWith('QF')) {
                    const startTime = parseTimeToHours(parts[6]); // STD
                    const endTime = parseTimeToHours(parts[8]); // STA
                    if (endTime > startTime) dutyHours = endTime - startTime;
                }
                const lastPart = parts[parts.length - 1];
                let rankOnLine = null, blockHours = 0;
                if (timeRegex.test(lastPart)) {
                    blockHours = parseTimeToHours(lastPart);
                    rankOnLine = parts[parts.length - 2];
                } else {
                    rankOnLine = lastPart;
                }
                if (!parsedData.rank && rankOnLine) {
                    const upperRank = rankOnLine.toUpperCase();
                    if (upperRank === 'FO') parsedData.rank = 'First Officer';
                    else if (upperRank === 'CPT' || upperRank === 'CAP') parsedData.rank = 'Captain';
                }
                parsedData.duties.push({ dutyCode, dutyHours, blockHours });
            });
            return parsedData;
        }
        
        function updateModalContent() {
            const res = calculationResults;
            const contentDiv = document.getElementById('modal-results-content');
            
            if(!res.annualSalary) {
                contentDiv.innerHTML = '<h3>Error</h3><p>Could not calculate pay. Please check inputs.</p>';
                return;
            }

            contentDiv.innerHTML = `
                <h3>Pay Calculation Results</h3>
                <div class="results-grid">
                    <p><strong>Rank:</strong></p><p>${res.finalRank}</p>
                    <p><strong>Home Base:</strong></p><p>${res.homeBase || 'N/A'}</p>
                    <p><strong>Annual Salary:</strong></p><p>$${res.annualSalary.toLocaleString('en-AU', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</p>
                </div>
                <hr>
                <h4>Pay Component Breakdown (Fortnightly Estimate)</h4>
                 <div class="results-grid">
                    <p>Base Pay:</p><p>$${res.fortnightlyBasePay.toLocaleString('en-AU', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</p>
                    <p>Productivity Bonus (${res.bonusHours.toFixed(2)} hrs):</p><p>$${res.productivityBonus.toLocaleString('en-AU', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</p>
                    <p>Overtime Pay (${res.overtimeHours.toFixed(2)} hrs):</p><p>$${res.overtimePay.toLocaleString('en-AU', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</p>
                </div>
                <hr>
                <h4>Totals</h4>
                <div class="results-grid">
                    <p><strong>Total Block Hours:</strong></p><p>${res.totalBlockHours.toFixed(2)}</p>
                    <p><strong>Total Duty Hours:</strong></p><p>${res.totalDutyHours.toFixed(2)}</p>
                </div>
                <div class="total-pay-section">
                    <h4>Estimated Total Fortnightly Gross Pay:</h4>
                    <p>$${res.totalGrossPay.toLocaleString('en-AU', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</p>
                </div>
            `;
        }

        /**
         * Main function to trigger the calculation process.
         */
        function runCalculation() {
            const selectedRankByUser = document.getElementById('rankSelect').value;
            const level = document.getElementById('levelSelect').value;
            const rosterText = document.getElementById('rosterInput').value;
            
            const rosterData = parseRoster(rosterText);
            const finalRank = rosterData.rank || selectedRankByUser;
            if(rosterData.rank) document.getElementById('rankSelect').value = finalRank;

            const annualSalary = EBA_DATA[finalRank]?.[level];
            if (!annualSalary) {
                calculationResults = { annualSalary: null };
                updateModalContent();
                showResultsModal();
                return;
            }
            
            const totalBlockHours = rosterData.duties.reduce((sum, duty) => sum + duty.blockHours, 0);
            const totalDutyHours = rosterData.duties.reduce((sum, duty) => sum + duty.dutyHours, 0);

            const bonusThreshold = 60;
            const bonusHours = Math.max(0, totalBlockHours - bonusThreshold);
            const productivityBonus = bonusHours * (EBA_DATA.ProductivityBonus[finalRank] || 0);
            
            const overtimeThreshold = 84;
            const overtimeHours = Math.max(0, totalDutyHours - overtimeThreshold);
            const overtimePay = overtimeHours * (EBA_DATA.OvertimeRate[finalRank] || 0);

            const fortnightlyBasePay = (annualSalary / 365.25) * 14;
            const totalGrossPay = fortnightlyBasePay + productivityBonus + overtimePay;

            // Store all results in the global variable
            calculationResults = {
                finalRank,
                homeBase: rosterData.homeBase,
                annualSalary,
                fortnightlyBasePay,
                bonusHours,
                productivityBonus,
                overtimeHours,
                overtimePay,
                totalBlockHours,
                totalDutyHours,
                totalGrossPay
            };
            
            // Update and show the modal
            updateModalContent();
            showResultsModal();
        }

    </script>
</body>
</html>
